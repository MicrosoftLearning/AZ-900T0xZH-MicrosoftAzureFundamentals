---
wts:
    title: '17 - 实现资源标记'
    module: '模块 03 - 安全性、隐私、合规性和信任'
---
# 17 - 实现资源标记

在本演练中，我们将创建一个要求标记的策略分配、创建一个存储帐户并测试该标记、查看带有指定标记的资源，并删除该标记策略。

预计用时：30 分钟

# 任务 1：创建策略分配

在此任务中，我们将配置 **需要指定标记** 策略，并将其分配给我们的订阅。 

1. 登录至 [Azure 门户](https://portal.azure.com)。

2. 搜索并选择 **策略**。 

3. 在 **创作** 部分下，单击 **分配**，然后在页面顶部选择 **分配策略**。

4. 注意，我们策略的 **范围** 将覆盖整个订阅。 

5. 选择 **策略定义** 省略号按钮（右侧文本框末尾）。  在 **搜索** 框中，键入 **标记**，然后单击 **需要指定标记** 定义，再单击 **选择**。

   ![“可用定义”窗格的屏幕截图，其中已选中“需要指定标记”。](../images/1701.png)

6.  在 **分配策略** 窗格中的 **参数** 选项卡中，对标记名称键入 **公司**。单击 **审阅+创建**，然后单击 **创建**。

    **注意：**这是演示标记的一个简单示例。 

    ![“分配策略”窗格的屏幕快照，其中已填写标记名称。](../images/1702.png)

7. **需要指定标记** 策略分配已就位。创建订阅资源后，必须提供公司标记值。

   ![此屏幕截图显示了“策略 - 分配”窗格，其中突出显示了允许的位置分配。](../images/1703.png)

# 任务 2：创建一个存储帐户以测试所需的标记

在此任务中，我们将创建存储帐户以测试所需的标记。 

1. 在 Azure 门户中，搜索并选择 **存储帐户**，然后单击 **+添加**。

2. 配置存储帐户。 

    | 设置 | 数值 | 
    | --- | --- |
    | 订阅 | **使用你的订阅** |
    | 资源组 | **myRGTags** （新） |
    | 存储帐户名称:  | **storageaccountxxx** （必须是唯一的） |
    | 地点 | **（美国）美国东部** |
    | | |

3. 单击 **审阅+创建**。 

**注意：**我们将进行测试以查看如果未提供标记会发生什么。 

4. 你将收到验证失败消息，然后单击 **点击此处以查看详细信息** 消息。在生成的 **错误** 边栏选项卡中的 **摘要** 选项卡上，请注意 **策略禁止资源** 错误消息。

    **注意：**如果查看“原始错误”选项卡，将看到所需的特定标记名称。 

    ![由于策略错误而未允许的屏幕截图。](../images/1704.png)

5. 关闭 **错误** 窗格并单击 **上一步** （屏幕底部）。提供标记信息。 

    | 设置 | 数值 | 
    | --- | --- |
    | 标记名称 | **公司**（可能不在下拉列表中） |
    | 标记值 | **Contoso** |
    | | |

6. 单击 **审阅+创建**，此时验证应该可以通过。单击 **创建** 以部署存储帐户。 

# 任务 3：查看带有特定标记的所有资源

1. 在门户中，搜索并选择 **标记**。

2. 注意，会显示所有可用的标记/值。选择 **公司：Contoso** 对，此时会列出你的存储帐户。必须部署你的存储帐户，才能显示标记。 

   ![“标记”的屏幕截图，其中选择了“公司”和“contoso”。](../images/1705.png)

3. 在门户中，搜索并选择 **所有资源**。

4. 单击 **添加筛选器** 并添加 **公司** 标记。注意，你可以将搜索限制为标记的可用值。应用筛选器后，将列出你的存储帐户。

    ![“所有资源”筛选器的屏幕截图，其中选择了“公司”。](../images/1706.png)

# 任务 4：删除策略分配

在此任务中，我们将删除 **需要指定标记** 策略，以免影响我们未来的工作。 

1. 在门户中，搜索并选择 **策略**，然后单击 **需要指定标记** 策略。

2. 在顶部菜单中选择 **删除分配**。

3. 通过单击 **是**，确认你希望删除 **删除分配** 对话框中的策略分配

5. 如果有时间，请尝试创建其他资源以确保该策略不再有效。

在本演练中，我们创建了一个要求标记的策略分配、创建了一个存储帐户并测试了该标记、查看了带有指定标记的资源，并删除了该标记策略。


**注意**：为避免产生额外费用，你可以删除此资源组。搜索资源组，单击你的资源组，然后单击 **删除资源组**。验证资源组的名称，然后单击 **删除**。关注 **通知**，了解删除操作的进度。